name: test

on:
  push:
    branches: [ main ]

jobs:
  main:
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
    - uses: actions/checkout@v3

    - uses: gacts/run-and-post-run@v1
      id: post-run-command
      if: |
        steps.one.outcome == 'failure' ||
        steps.two.outcome != 'success' ||
        steps.three.outcome != 'success'
      with:
        #env:
        #  STEPS_FAIL: "${{ (steps.one.outcome == 'failure' || steps.two.outcome == 'failure' || steps.three.outcome == 'failure') }}"
        #  STEPS_PASS: "${{ (steps.one.outcome == 'success' || steps.one.outcome == 'skipped') }}"
        post: |
          echo "::group::Step results"
          echo "one=${{ steps.one.outcome }}"
          echo "two=${{ steps.two.outcome }}"
          echo "three=${{ steps.three.outcome }}"
          echo "::endgroup::"
          X="true"
          Y="false"
          XB=true
          YB=false
          if [ $X ]; then echo "X"; fi
          if [ $XB ]; then echo "XB"; fi
          if [ $Y ]; then echo "Y"; fi
          if [ $YB ]; then echo "YB"; fi
          FAIL="${{ (steps.one.outcome == 'failure' || steps.two.outcome == 'failure' || steps.three.outcome == 'failure') }}"
          PASS="${{ (steps.one.outcome == 'success' || steps.one.outcome == 'skipped') }}"
          echo "FAIL=${FAIL}"
          echo "PASS=${PASS}"
          #if [ "$FAIL" == "true" ]; then echo "failed"; fi
          #if [ "$FAIL" == "false" ]; then echo "passed"; fi
          #if [ "$FAIL" != "" ]; then echo "::error::One or more steps failed"; exit 1; fi

    - id: one
      #if: ${{ 1 == 2 }}
      continue-on-error: true
      run: exit 1
    - id: two
      continue-on-error: true
      run: exit 0
    - id: three
      continue-on-error: true
      run: exit 0

